"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var inputEventTypes=["input","textarea","$input","$textarea"],defaultCompProps={transfer:!0};function getModelProp(){return"value"}function getModelEvent(){return"input"}function getChangeEvent(e){return-1<inputEventTypes.indexOf(e.name)?"input":"change"}function parseDate(e,t){return e&&t.valueFormat?_xeUtils.default.toStringDate(e,t.valueFormat):e}function getFormatDate(e,t,r){var n=t.dateConfig,o=void 0===n?{}:n;return _xeUtils.default.toDateString(parseDate(e,t),o.labelFormat||r)}function getLabelFormatDate(e,t){return getFormatDate(e,t,_conf.default.i18n("vxe.input.date.labelFormat.".concat(t.type)))}function getDefaultComponentName(e){var t=e.name;return"vxe-".concat(t.replace("$",""))}function handleConfirmFilter(e,t,r){e.$panel.changeOption({},t,r)}function getNativeAttrs(e){var t=e.name,r=e.attrs;return"input"===t&&(r=Object.assign({type:"text"},r)),r}function getCellEditFilterProps(e,t,r,n){var o=t.$table.vSize;return _xeUtils.default.assign(o?{size:o}:{},defaultCompProps,n,e.props,_defineProperty({},getModelProp(e),r))}function getItemProps(e,t,r,n){var o=t.$form.vSize;return _xeUtils.default.assign(o?{size:o}:{},defaultCompProps,n,e.props,_defineProperty({},getModelProp(e),r))}function getOns(e,o,t,n){var a=e.events,r=getModelEvent(e),l=getChangeEvent(e),u=l===r,i={};return _xeUtils.default.objectEach(a,function(n,e){i[e]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,[o].concat(t))}}),t&&(i[r]=function(e){t(e),a&&a[r]&&a[r](e),u&&n&&n(e)}),!u&&n&&(i[l]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(void 0,t),a&&a[l]&&a[l].apply(a,[o].concat(t))}),i}function getEditOns(e,t){var r=t.$table,n=t.row,o=t.column;return getOns(e,t,function(e){_xeUtils.default.set(n,o.property,e)},function(){r.updateStatus(t)})}function getFilterOns(e,t,r){return getOns(e,t,function(e){r.data=e},function(){handleConfirmFilter(t,!_xeUtils.default.eqNull(r.data),r)})}function getItemOns(e,t){var r=t.$form,n=t.data,o=t.property;return getOns(e,t,function(e){_xeUtils.default.set(n,o,e)},function(){r.updateStatus(t)})}function isSyncCell(e,t){return e.immediate||"visible"===e.type||"cell"===t.$type}function getNativeEditOns(r,n){var o=n.$table,a=n.row,l=n.column,u=l.model;return getOns(r,n,function(e){var t=e.target.value;isSyncCell(r,n)?_tools.UtilTools.setCellValue(a,l,t):(u.update=!0,u.value=t)},function(e){var t=e.target.value;o.updateStatus(n,t)})}function getNativeFilterOns(e,t,r){return getOns(e,t,function(e){r.data=e.target.value},function(){handleConfirmFilter(t,!_xeUtils.default.eqNull(r.data),r)})}function getNativeItemOns(e,t){var r=t.$form,n=t.data,o=t.property;return getOns(e,t,function(e){var t=e.target.value;_xeUtils.default.set(n,o,t)},function(){r.updateStatus(t)})}function nativeEditRender(e,t,r){var n=r.row,o=r.column,a=t.name,l=getNativeAttrs(t),u=isSyncCell(t,r)?_tools.UtilTools.getCellValue(n,o):o.model.value;return[e(a,{class:"vxe-default-".concat(a),attrs:l,domProps:{value:u},on:getNativeEditOns(t,r)})]}function defaultEditRender(e,t,r){var n=r.row,o=r.column,a=_tools.UtilTools.getCellValue(n,o);return[e(getDefaultComponentName(t),{props:getCellEditFilterProps(t,r,a),on:getEditOns(t,r)})]}function defaultButtonEditRender(e,t,r){return[e("vxe-button",{props:getCellEditFilterProps(t,r),on:getOns(t,r)})]}function defaultButtonsEditRender(t,e,r){return e.children.map(function(e){return defaultButtonEditRender(t,e,r)[0]})}function renderNativeOptgroups(r,n,o,a){var e=n.optionGroups,t=n.optionGroupProps,l=void 0===t?{}:t,u=l.options||"options",i=l.label||"label";return e.map(function(e,t){return r("optgroup",{key:t,domProps:{label:e[i]}},a(r,e[u],n,o))})}function renderDefaultOptgroups(r,n,o,a){var e=n.optionGroups,t=n.optionGroupProps,l=void 0===t?{}:t,u=l.options||"options",i=l.label||"label";return e.map(function(e,t){return r("vxe-optgroup",{key:t,props:{label:e[i]}},a(r,e[u],n,o))})}function renderNativeOptions(r,e,t,n){var o=t.optionProps,a=void 0===o?{}:o,l=n.row,u=n.column,i=a.label||"label",d=a.value||"value",s=a.disabled||"disabled",p=isSyncCell(t,n)?_tools.UtilTools.getCellValue(l,u):u.model.value;return e.map(function(e,t){return r("option",{key:t,attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p}},e[i])})}function renderDefaultOptions(r,e,t,n){var o=t.optionProps,a=void 0===o?{}:o,l=a.label||"label",u=a.value||"value",i=a.disabled||"disabled";return e.map(function(e,t){return r("vxe-option",{key:t,props:{value:e[u],label:e[l],disabled:e[i]}})})}function nativeFilterRender(r,n,o){var e=o.column,a=n.name,l=getNativeAttrs(n);return e.filters.map(function(e,t){return r(a,{key:t,class:"vxe-default-".concat(a),attrs:l,domProps:{value:e.data},on:getNativeFilterOns(n,o,e)})})}function defaultFilterRender(n,o,a){return a.column.filters.map(function(e,t){var r=e.data;return n(getDefaultComponentName(o),{key:t,props:getCellEditFilterProps(o,o,r),on:getFilterOns(o,a,e)})})}function handleFilterMethod(e){var t=e.option,r=e.row,n=e.column,o=t.data;return _xeUtils.default.get(r,n.property)==o}function nativeSelectEditRender(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeEditOns(t,r)},t.optionGroups?renderNativeOptgroups(e,t,r,renderNativeOptions):renderNativeOptions(e,t.options,t,r))]}function defaultSelectEditRender(e,t,r){var n=r.row,o=r.column,a=_tools.UtilTools.getCellValue(n,o);return[e(getDefaultComponentName(t),{props:getCellEditFilterProps(t,r,a),on:getEditOns(t,r)},t.optionGroups?renderDefaultOptgroups(e,t,r,renderDefaultOptions):renderDefaultOptions(e,t.options,t,r))]}function getSelectCellValue(e,t){var r,n=t.row,o=t.column,a=e.options,l=e.optionGroups,u=e.optionProps,i=void 0===u?{}:u,d=e.optionGroupProps,s=void 0===d?{}:d,p=_xeUtils.default.get(n,o.property),f=i.label||"label",c=i.value||"value";if(l){for(var v=s.options||"options",m=0;m<l.length&&!(r=_xeUtils.default.find(l[m][v],function(e){return e[c]==p}));m++);return r?r[f]:p}return(r=_xeUtils.default.find(a,function(e){return e[c]==p}))?r[f]:p}function nativeItemRender(e,t,r){var n=r.data,o=r.property,a=t.name,l=getNativeAttrs(t),u=_xeUtils.default.get(n,o);return[e(a,{class:"vxe-default-".concat(a),attrs:l,domProps:!l||"input"!==a||"submit"!==l.type&&"reset"!==l.type?{value:u}:null,on:getNativeItemOns(t,r)})]}function defaultItemRender(e,t,r){var n=r.data,o=r.property,a=_xeUtils.default.get(n,o);return[e(getDefaultComponentName(t),{props:getItemProps(t,r,a),on:getItemOns(t,r)})]}function defaultButtonItemRender(e,t,r){return[e("vxe-button",{props:getItemProps(t,r),on:getOns(t,r)})]}function defaultButtonsItemRender(t,e,r){return e.children.map(function(e){return defaultButtonItemRender(t,e,r)[0]})}function renderNativeFormOptions(r,e,t,n){var o=n.data,a=n.property,l=t.optionProps,u=void 0===l?{}:l,i=u.label||"label",d=u.value||"value",s=u.disabled||"disabled",p=_xeUtils.default.get(o,a);return e.map(function(e,t){return r("option",{key:t,attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p}},e[i])})}function createExportMethod(t,e){var r=e?"editRender":"cellRender";return function(e){return t(e.column[r],e)}}function defaultFormItemRadioAndCheckboxRender(r,e,t){var n=e.options,o=e.optionProps,a=void 0===o?{}:o,l=t.data,u=t.property,i=a.label||"label",d=a.value||"value",s=a.disabled||"disabled",p=_xeUtils.default.get(l,u),f=getDefaultComponentName(e);return[r("".concat(f,"-group"),{props:getItemProps(e,t,p),on:getItemOns(e,t)},n.map(function(e,t){return r(f,{key:t,props:{label:e[d],content:e[i],disabled:e[s]}})}))]}var renderMap={input:{autofocus:"input",renderEdit:nativeEditRender,renderDefault:nativeEditRender,renderFilter:nativeFilterRender,filterMethod:handleFilterMethod,renderItem:nativeItemRender},textarea:{autofocus:"textarea",renderEdit:nativeEditRender,renderItem:nativeItemRender},select:{renderEdit:nativeSelectEditRender,renderDefault:nativeSelectEditRender,renderCell:function(e,t,r){return getSelectCellValue(t,r)},renderFilter:function(r,n,o){return o.column.filters.map(function(e,t){return r("select",{key:t,class:"vxe-default-select",attrs:getNativeAttrs(n),on:getNativeFilterOns(n,o,e)},n.optionGroups?renderNativeOptgroups(r,n,o,renderNativeOptions):renderNativeOptions(r,n.options,n,o))})},filterMethod:handleFilterMethod,renderItem:function(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeItemOns(t,r)},t.optionGroups?renderNativeOptgroups(e,t,r,renderNativeFormOptions):renderNativeFormOptions(e,t.options,t,r))]},editCellExportMethod:createExportMethod(getSelectCellValue,!0),cellExportMethod:createExportMethod(getSelectCellValue)},$input:{autofocus:".vxe-input--inner",renderEdit:defaultEditRender,renderCell:function(e,t,r){var n=t.props,o=void 0===n?{}:n,a=r.row,l=r.column,u=_xeUtils.default.get(a,l.property);if(u)switch(o.type){case"date":case"week":case"month":case"year":u=getLabelFormatDate(u,o);break;case"float":u=_xeUtils.default.toFixedString(u,_xeUtils.default.toNumber(o.digits||_conf.default.input.digits))}return u},renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:handleFilterMethod,renderItem:defaultItemRender},$textarea:{autofocus:".vxe-textarea--inner",renderItem:defaultItemRender},$button:{renderDefault:defaultButtonEditRender,renderItem:defaultButtonItemRender},$buttons:{renderDefault:defaultButtonsEditRender,renderItem:defaultButtonsItemRender},$select:{renderEdit:defaultSelectEditRender,renderDefault:defaultSelectEditRender,renderCell:function(e,t,r){return getSelectCellValue(t,r)},renderFilter:function(n,o,a){return a.column.filters.map(function(e,t){var r=e.data;return n(getDefaultComponentName(o),{key:t,props:getCellEditFilterProps(o,a,r),on:getFilterOns(o,a,e)},o.optionGroups?renderDefaultOptgroups(n,o,a,renderDefaultOptions):renderDefaultOptions(n,o.options,o,a))})},filterMethod:handleFilterMethod,renderItem:function(e,t,r){var n=r.data,o=r.property,a=_xeUtils.default.get(n,o);return[e(getDefaultComponentName(t),{props:getItemProps(t,r,a),on:getItemOns(t,r)},t.optionGroups?renderDefaultOptgroups(e,t,r,renderDefaultOptions):renderDefaultOptions(e,t.options,t,r))]},editCellExportMethod:createExportMethod(getSelectCellValue,!0),cellExportMethod:createExportMethod(getSelectCellValue)},$radio:{renderItem:defaultFormItemRadioAndCheckboxRender},$checkbox:{renderItem:defaultFormItemRadioAndCheckboxRender},$switch:{renderEdit:defaultEditRender,renderDefault:defaultEditRender,renderItem:defaultItemRender}},renderer={mixin:function(e){return _xeUtils.default.each(e,function(e,t){return renderer.add(t,e)}),renderer},get:function(e){return renderMap[e]||null},add:function(e,t){if(e&&t){var r=renderMap[e];r?Object.assign(r,t):renderMap[e]=t}return renderer},delete:function(e){return delete renderMap[e],renderer}},_default=renderer;exports.default=_default;