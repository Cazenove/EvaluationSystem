"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var _default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,i=e.elemStore,r="".concat(o||"main","-header-");i["".concat(r,"wrapper")]=t,i["".concat(r,"table")]=l.table,i["".concat(r,"colgroup")]=l.colgroup,i["".concat(r,"list")]=l.thead,i["".concat(r,"xSpace")]=l.xSpace,i["".concat(r,"repair")]=l.repair},render:function(C){var w=this,e=this._e,$=this.$parent,T=this.fixedType,t=this.headerColumn,l=this.fixedColumn,o=this.tableColumn,z=$.$listeners,i=$.tId,P=$.resizable,S=$.border,D=$.columnKey,r=$.headerRowClassName,k=$.headerCellClassName,n=$.headerRowStyle,R=$.headerCellStyle,W=$.showHeaderOverflow,M=$.headerAlign,U=$.align,H=$.highlightCurrentColumn,O=$.currentColumn,a=$.mouseConfig,s=$.mouseOpts,q=$.scrollXLoad,A=$.overflowX,d=$.scrollbarWidth,E=$.getColumnIndex,I=$.sortOpts,L=a&&s.selected,B=a&&(s.range||s.checked);return q&&T&&(o=l),C("div",{class:["vxe-table--header-wrapper",T?"fixed-".concat(T,"--wrapper"):"body--wrapper"],attrs:{"data-tid":i}},[T?e():C("div",{class:"vxe-body--x-space",ref:"xSpace"}),C("table",{class:"vxe-table--header",attrs:{"data-tid":i,cellspacing:0,cellpadding:0,border:0},ref:"table"},[C("colgroup",{ref:"colgroup"},o.map(function(e,t){return C("col",{attrs:{name:e.id},key:t})}).concat(d?[C("col",{attrs:{name:"col_gutter"}})]:[])),C("thead",{ref:"thead"},t.map(function(_,y){return C("tr",{class:["vxe-header--row",r?_xeUtils.default.isFunction(r)?r({$table:$,$rowIndex:y,fixed:T}):r:""],style:n?_xeUtils.default.isFunction(n)?n({$table:$,$rowIndex:y,fixed:T}):n:null},_.map(function(t,e){var l,o=t.showHeaderOverflow,i=t.headerAlign,r=t.align,n=t.headerClassName,a=t.children&&t.children.length,s=T?t.fixed!==T&&!a:t.fixed&&A,d=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?W:o,c=i||r||M||U,u="ellipsis"===d,f="title"===d,p=!0===d||"tooltip"===d,h=f||p||u,m={},x=t.filters&&t.filters.some(function(e){return e.checked}),g=E(t),v={$table:$,$rowIndex:y,column:t,columnIndex:g,$columnIndex:e,fixed:T,isHidden:s,hasFilter:x};q&&!h&&(u=h=!0),(f||p)&&(m.mouseenter=function(e){$._isResize||(f?_tools.DomTools.updateCellTitle(e,t):p&&$.triggerHeaderTooltipEvent(e,v))}),p&&(m.mouseleave=function(e){$._isResize||p&&$.handleTargetLeaveEvent(e)}),(H||z["header-cell-click"]||B||"cell"===I.trigger)&&(m.click=function(e){return $.triggerHeaderCellClickEvent(e,v)}),z["header-cell-dblclick"]&&(m.dblclick=function(e){return $.triggerHeaderCellDBLClickEvent(e,v)}),(L||B)&&(m.mousedown=function(e){return $.triggerHeaderCellMousedownEvent(e,v)});var b="seq"===t.type||"index"===t.type?"seq":t.type;return C("th",{class:["vxe-header--column",t.id,(_defineProperty(l={},"col--".concat(c),c),_defineProperty(l,"col--".concat(b),b),_defineProperty(l,"col--last",e===_.length-1),_defineProperty(l,"col--fixed",t.fixed),_defineProperty(l,"col--group",a),_defineProperty(l,"col--ellipsis",h),_defineProperty(l,"fixed--hidden",s),_defineProperty(l,"is--sortable",t.sortable),_defineProperty(l,"is--filter",!!t.filters),_defineProperty(l,"filter--active",x),_defineProperty(l,"col--current",O===t),l),_tools.UtilTools.getClass(n,v),_tools.UtilTools.getClass(k,v)],attrs:{"data-colid":t.id,colspan:1<t.colSpan?t.colSpan:null,rowspan:1<t.rowSpan?t.rowSpan:null},style:R?_xeUtils.default.isFunction(R)?R(v):R:null,on:m,key:D||a?t.id:e},[C("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":u}]},t.renderHeader(C,v)),!s&&!a&&(_xeUtils.default.isBoolean(t.resizable)?t.resizable:P)?C("div",{class:["vxe-resizable",{"is--line":!S||"none"===S}],on:{mousedown:function(e){return w.resizeMousedown(e,v)}}}):null])}).concat(d?[C("th",{class:"col--gutter"})]:[]))}))]),C("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var l=t.column,o=this.$parent,i=this.$el,r=this.fixedType,n=o.$refs,a=n.tableBody,s=n.leftContainer,d=n.rightContainer,c=n.resizeBar,u=e.target,f=e.clientX,p=u.parentNode,h=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,i),g=u.clientWidth,v=Math.floor(g/2),b=l.getMinWidth()-v,_=x.left-p.clientWidth+g+b,y=x.left+v,C=document.onmousemove,w=document.onmouseup,$="left"===r,T="right"===r,z=0;if($||T){for(var P=$?"nextElementSibling":"previousElementSibling",S=p[P];S&&!_tools.DomTools.hasClass(S,"fixed--hidden");)_tools.DomTools.hasClass(S,"col--group")||(z+=S.offsetWidth),S=S[P];T&&d&&(y=d.offsetLeft+z)}function D(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,l=y+t,o=r?0:m.scrollLeft;$?l=Math.min(l,(d?d.offsetLeft:m.clientWidth)-z-b):T&&(_=(s?s.clientWidth:0)+z+b,l=Math.min(l,y+p.clientWidth-b)),h=Math.max(l,_),c.style.left="".concat(h-o,"px")}o._isResize=!0,_tools.DomTools.addClass(o.$el,"c--resize"),c.style.display="block",document.onmousemove=D,document.onmouseup=function(){document.onmousemove=C,document.onmouseup=w,l.resizeWidth=l.renderWidth+(T?y-h:h-y),c.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.recalculate(!0),_tools.DomTools.removeClass(o.$el,"c--resize"),o.saveCustomResizable(),o.$emit("resizable-change",Object.assign({$event:e},t))},D(e)}}};exports.default=_default;